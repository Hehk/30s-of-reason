{"dependencies":[{"name":"apollo-utilities","loc":{"line":19,"column":65}},{"name":"./networkStatus","loc":{"line":20,"column":56}},{"name":"../util/Observable","loc":{"line":21,"column":27}},{"name":"../errors/ApolloError","loc":{"line":22,"column":28}},{"name":"./types","loc":{"line":23,"column":26}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.ObservableQuery=exports.hasError=void 0;var r=require(\"apollo-utilities\"),e=require(\"./networkStatus\"),t=require(\"../util/Observable\"),s=require(\"../errors/ApolloError\"),o=require(\"./types\"),i=function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])};return function(e,t){function s(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}(),n=Object.assign||function(r){for(var e,t=1,s=arguments.length;t<s;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o]);return r},a=exports.hasError=function(r,e){return void 0===e&&(e=\"none\"),r&&(r.graphQLErrors&&r.graphQLErrors.length>0&&\"none\"===e||r.networkError)},u=function(t){function u(r){var e=r.scheduler,s=r.options,o=r.shouldSubscribe,i=void 0===o||o,n=t.call(this,function(r){return n.onSubscribe(r)})||this;return n.isCurrentlyPolling=!1,n.isTornDown=!1,n.options=s,n.variables=s.variables||{},n.queryId=e.queryManager.generateQueryId(),n.shouldSubscribe=i,n.scheduler=e,n.queryManager=e.queryManager,n.observers=[],n.subscriptionHandles=[],n}return i(u,t),u.prototype.result=function(){var r=this;return new Promise(function(e,t){var s,o={next:function(t){e(t),r.observers.some(function(r){return r!==o})||r.queryManager.removeQuery(r.queryId),setTimeout(function(){s.unsubscribe()},0)},error:function(r){t(r)}};s=r.subscribe(o)})},u.prototype.currentResult=function(){if(this.isTornDown)return{data:this.lastError?{}:this.lastResult?this.lastResult.data:{},error:this.lastError,loading:!1,networkStatus:e.NetworkStatus.error};var r=this.queryManager.queryStore.get(this.queryId);if(a(r,this.options.errorPolicy))return{data:{},loading:!1,networkStatus:r.networkStatus,error:new s.ApolloError({graphQLErrors:r.graphQLErrors,networkError:r.networkError})};var t,o=this.queryManager.getCurrentQueryResult(this),i=o.data,u=o.partial,l=!r||r.networkStatus===e.NetworkStatus.loading,h=\"network-only\"===this.options.fetchPolicy&&l||u&&\"cache-only\"!==this.options.fetchPolicy;t=r?r.networkStatus:h?e.NetworkStatus.loading:e.NetworkStatus.ready;var c={data:i,loading:(0,e.isNetworkRequestInFlight)(t),networkStatus:t};if(r&&r.graphQLErrors&&\"all\"===this.options.errorPolicy&&(c.errors=r.graphQLErrors),!u){this.lastResult=n({},c,{stale:!1})}return n({},c,{partial:u})},u.prototype.getLastResult=function(){return this.lastResult},u.prototype.getLastError=function(){return this.lastError},u.prototype.resetLastResults=function(){delete this.lastResult,delete this.lastError,this.isTornDown=!1},u.prototype.refetch=function(e){if(\"cache-only\"===this.options.fetchPolicy)return Promise.reject(new Error(\"cache-only fetchPolicy option should not be used together with query refetch.\"));(0,r.isEqual)(this.variables,e)||(this.variables=n({},this.variables,e)),(0,r.isEqual)(this.options.variables,this.variables)||(this.options.variables=n({},this.options.variables,this.variables));var t=n({},this.options,{fetchPolicy:\"network-only\"});return this.queryManager.fetchQuery(this.queryId,t,o.FetchType.refetch).then(function(e){return(0,r.maybeDeepFreeze)(e)})},u.prototype.fetchMore=function(r){var e=this;if(!r.updateQuery)throw new Error(\"updateQuery option is required. This function defines how to update the query data with the new results.\");return Promise.resolve().then(function(){var t,s=e.queryManager.generateQueryId();return(t=r.query?r:n({},e.options,r,{variables:n({},e.variables,r.variables)})).fetchPolicy=\"network-only\",e.queryManager.fetchQuery(s,t,o.FetchType.normal,e.queryId)}).then(function(t){return e.updateQuery(function(e,s){var o=s.variables;return r.updateQuery(e,{fetchMoreResult:t.data,variables:o})}),t})},u.prototype.subscribeToMore=function(r){var e=this,t=this.queryManager.startGraphQLSubscription({query:r.document,variables:r.variables}).subscribe({next:function(t){r.updateQuery&&e.updateQuery(function(e,s){var o=s.variables;return r.updateQuery(e,{subscriptionData:t,variables:o})})},error:function(e){r.onError?r.onError(e):console.error(\"Unhandled GraphQL subscription error\",e)}});return this.subscriptionHandles.push(t),function(){var r=e.subscriptionHandles.indexOf(t);r>=0&&(e.subscriptionHandles.splice(r,1),t.unsubscribe())}},u.prototype.setOptions=function(r){var e=this.options;this.options=n({},this.options,r),r.pollInterval?this.startPolling(r.pollInterval):0===r.pollInterval&&this.stopPolling();var t=\"network-only\"!==e.fetchPolicy&&\"network-only\"===r.fetchPolicy||\"cache-only\"===e.fetchPolicy&&\"cache-only\"!==r.fetchPolicy||\"standby\"===e.fetchPolicy&&\"standby\"!==r.fetchPolicy||!1;return this.setVariables(this.options.variables,t,r.fetchResults)},u.prototype.setVariables=function(e,t,s){void 0===t&&(t=!1),void 0===s&&(s=!0),this.isTornDown=!1;var o=n({},this.variables,e);return(0,r.isEqual)(o,this.variables)&&!t?0!==this.observers.length&&s?this.result():new Promise(function(r){return r()}):(this.lastVariables=this.variables,this.variables=o,this.options.variables=o,0===this.observers.length?new Promise(function(r){return r()}):this.queryManager.fetchQuery(this.queryId,n({},this.options,{variables:this.variables})).then(function(e){return(0,r.maybeDeepFreeze)(e)}))},u.prototype.updateQuery=function(e){var t=this.queryManager.getQueryWithPreviousResult(this.queryId),s=t.previousResult,o=t.variables,i=t.document,n=(0,r.tryFunctionOrLogError)(function(){return e(s,{variables:o})});n&&(this.queryManager.dataStore.markUpdateQueryResult(i,o,n),this.queryManager.broadcastQueries())},u.prototype.stopPolling=function(){this.isCurrentlyPolling&&(this.scheduler.stopPollingQuery(this.queryId),this.options.pollInterval=void 0,this.isCurrentlyPolling=!1)},u.prototype.startPolling=function(r){if(\"cache-first\"===this.options.fetchPolicy||\"cache-only\"===this.options.fetchPolicy)throw new Error(\"Queries that specify the cache-first and cache-only fetchPolicies cannot also be polling queries.\");this.isCurrentlyPolling&&(this.scheduler.stopPollingQuery(this.queryId),this.isCurrentlyPolling=!1),this.options.pollInterval=r,this.isCurrentlyPolling=!0,this.scheduler.startPollingQuery(this.options,this.queryId)},u.prototype.onSubscribe=function(r){var e=this;return r._subscription&&r._subscription._observer&&!r._subscription._observer.error&&(r._subscription._observer.error=function(r){console.error(\"Unhandled error\",r.message,r.stack)}),this.observers.push(r),r.next&&this.lastResult&&r.next(this.lastResult),r.error&&this.lastError&&r.error(this.lastError),1===this.observers.length&&this.setUpQuery(),function(){e.observers=e.observers.filter(function(e){return e!==r}),0===e.observers.length&&e.tearDownQuery()}},u.prototype.setUpQuery=function(){var r=this;if(this.shouldSubscribe&&this.queryManager.addObservableQuery(this.queryId,this),this.options.pollInterval){if(\"cache-first\"===this.options.fetchPolicy||\"cache-only\"===this.options.fetchPolicy)throw new Error(\"Queries that specify the cache-first and cache-only fetchPolicies cannot also be polling queries.\");this.isCurrentlyPolling=!0,this.scheduler.startPollingQuery(this.options,this.queryId)}var e={next:function(e){r.lastResult=e,r.observers.forEach(function(r){return r.next&&r.next(e)})},error:function(e){r.lastError=e,r.observers.forEach(function(r){return r.error&&r.error(e)})}};this.queryManager.startQuery(this.queryId,this.options,this.queryManager.queryListenerForObserver(this.queryId,this.options,e))},u.prototype.tearDownQuery=function(){this.isTornDown=!0,this.isCurrentlyPolling&&(this.scheduler.stopPollingQuery(this.queryId),this.isCurrentlyPolling=!1),this.subscriptionHandles.forEach(function(r){return r.unsubscribe()}),this.subscriptionHandles=[],this.queryManager.removeObservableQuery(this.queryId),this.queryManager.stopQuery(this.queryId),this.observers=[]},u}(t.Observable);exports.ObservableQuery=u;"},"hash":"5ce8fd5834669a69169a2a3a8ec92cfc","cacheData":{"env":{}}}